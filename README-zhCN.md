Somi-dashjs
================
Somi-dashjs 是一个非常轻量的js包,起作用是通过使用MediaSource扩展实现视频流的碎片化下载,然后把得到的视频碎片流喂video元素来进行播放.

>__[English document](https://github.com/SomiFrame/somi-dashjs/blob/master/README.md)__

>__线上例子__ [https://somiframe.github.io/vue-video/](https://somiframe.github.io/vue-video/)

关于问题提交
================
> __如果你在somi-dashjs使用上或者不知道如何创建dash视频?__

> __请到issue区域提交问题让我知道:)__

安装
================
目前已维护到npm包管理器上,可以执行一下命令就能下载到你的项目中
```shell
    npm install somi-dashjs
```

如何创建一个dashify后的视频?
===============
> __首先你要先下载并安装 [MP4Box](https://gpac.wp.imt.fr/2015/07/29/gpac-build-mp4box-only-all-platforms/)__

> __以下是一个简单的MP4Box的切割视频的命令例子(当然你得准备一个视频,下面的视频可以在下载git代码后的public/video文件夹里面找到)__
```shell
   MP4Box -dash 3000 -profile onDemand -out manifest.mpd VivaLaVida.mp4
```
> __如果你想了解更多MP4Box的参数使用可以到__ [Dash Support in MP4Box](https://gpac.wp.imt.fr/mp4box/dash/)

> __当你执行完上述命令后 可以获得manifest.mpd 和 VivaLaVida_dashinit.mp4 文件__

> __VivaLaVida_dashinit.mp4是dashify后的视频

> __下面是manifest.mpd文件的详细信息__
```xml
<?xml version="1.0"?>
<!-- MPD file Generated with GPAC version 0.6.2-DEV-rev1219-g4007cec-master  at 2017-05-18T04:06:16.663Z-->
<MPD xmlns="urn:mpeg:dash:schema:mpd:2011" minBufferTime="PT1.500S" type="static" mediaPresentationDuration="PT0H4M2.091S" maxSegmentDuration="PT0H0M10.000S" profiles="urn:mpeg:dash:profile:isoff-on-demand:2011">
 <ProgramInformation moreInformationURL="http://gpac.io">
  <Title>manifest.mpd generated by GPAC</Title>
 </ProgramInformation>

 <Period duration="PT0H4M2.091S">
  <AdaptationSet segmentAlignment="true" maxWidth="1280" maxHeight="720" maxFrameRate="25" par="16:9" lang="und" subsegmentAlignment="true" subsegmentStartsWithSAP="1">
   <ContentComponent id="1" contentType="video" />
   <ContentComponent id="2" contentType="audio" />
   <Representation id="1" mimeType="video/mp4" codecs="avc1.4d401f,mp4a.40.2" width="1280" height="720" frameRate="25" sar="1:1" audioSamplingRate="44100" startWithSAP="1" bandwidth="1280527">
    <AudioChannelConfiguration schemeIdUri="urn:mpeg:dash:23003:3:audio_channel_configuration:2011" value="2"/>
    <BaseURL>VivaLaVida_dashinit.mp4</BaseURL>
    <SegmentBase indexRangeExact="true" indexRange="1437-1900">
      <Initialization range="0-1436"/>
    </SegmentBase>
   </Representation>
  </AdaptationSet>
 </Period>
</MPD>
```

使用方法
================
```javascript
    // this is es5 version
    // cmd模式需要browserify编译后才能让浏览器识别

    var dash = require("somi-dashjs");
    if(dash.isSupportDash()){
        var segmentUrl = '/video/VivaLaVida_dashinit.mp4';
        var videoMimeTypeCodecs = 'video/mp4;codecs="avc1.4D401F,mp4a.40.2"';
        var initRange = {start: 0, end: 1436};
        var sidxRange = {start: 1437, end: 1900};
        new dash('#vid1',segmentUrl,videoMimeTypeCodecs,initRange,sidxRange);
    }

    // this is es6 version
    // es6模式需要babelify编译之后才能让浏览器识别

    import dash from "somi-dashjs";
    if(dash.isSupportDash()){
        let segmentUrl = '/video/VivaLaVida_dashinit.mp4';
        let videoMimeTypeCodecs = 'video/mp4;codecs="avc1.4D401F,mp4a.40.2"';
        let initRange = {start: 0, end: 1436};
        let sidxRange = {start: 1437, end: 1900};
        new dash('#vid1',segmentUrl,videoMimeTypeCodecs,initRange,sidxRange);
     }
```

测试test文件夹的代码
================
首先
----------------
* 克隆代码到你的本地环境

```
    git clone https://github.com/SomiFrame/somi-dashjs.git
```
* 或者
```
    git clone git@github.com:SomiFrame/somi-dashjs.git
```

第二
---------------
* 进入你刚刚下载的项目代码的根目录
```
    cd somi-dashjs
```
* 安装运行所需要的js依赖包
```
    npm install
```
* 编译src文件甲的源代码到public/js中(这里使用的是gulp自动化工具)
```
    gulp
```
* 开启node服务并监听3031端口
```
    node server.js
```
第三
---------------
* 现在你可以打开浏览器并在地址输入栏输入如下地址就可以了

  __localhost:3031__